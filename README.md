# VK-бот для подбора пары - VKinder


### Описание

Этот проект представляет собой бот для социальной сети ВКонтакте (VK), который подбирает пользователю подходящую пару для знакомства. Бот использует VK API для получения данных профилей пользователей с учетом фильтров и возможностью сохранять профили в "Избранное".


### Функционал бота

- Бот получает открытые данные обратившегося к нему пользователя и автоматически устанавливает поисковые фильтры.
- Если получить необходимые данные невозможно (настройки ограничений или незаполненные данные профиля) бот автоматически запрашивает пользователя согласия на ввод недостающих данных.
- Реализован контроль корректности ввода персональных данных. При некорректном вводе бот предлагает повторить ввод.
- Бот ищет пары по следующим фильтрам: город, пол, статус отношений (не состоит в браке или в активном поиске) диапазон возрастов (на основании даты рождения).
- Реализована возможность настроить поисковые фильтры.
- Параметры поиска сохраняются для каждого пользователя, обратившегося к боту.
- Позиция поиска сохраняется в памяти бота и сбрасывается только при изменении параметров поиска.
- Добавление в избранное: профили понравившихся людей можно добавлять в избранное и позднее просматривать.
- Добавление в черный список: профили, добавленные в черный список удаляются из результатов поиска и не показываются при дальнешем поиске.
- В качестве результатов поиска предоставляются: Имя, Фамилия, город, ссылка на страницу профиля в ВК и от одной до трех фотографий из альбома profile.


### Ограничения бота

- Ограничение по количеству фото: количество выводимых фотографий может варьироваться от одной до трех, в завиимости от их количества в профиле пользователя.
- Ограничение по количеству результатов: количество предоставляемых профилей в рамках одного запроса ограничено возможностями pool-запроса и может состовлять от нескольких штук до двух десятков, в зависимости от того, сколько неполных или закрытых профелей было в рамках одного поиска. Функция поиска профилей позволяет увеличивать количество результатов за счет скорости работы (см. описание функции find mutch в модуле api_requests).
- Ограничения API VK: API ВКонтакте имеет свои ограничения на количество запросов в секунду, что может привести к ограничениям в работе бота при большой нагрузке.
- Ограничения по доступу к данным профилей: бот может получить доступ к данным профилей пользователей только в том случае, если эти данные доступны для публичного просмотра.
- Ограничения по функциональности: бот имеет определенный набор функций, и его возможности ограничены теми API и сервисами, которые он использует.


### Настройка программы

1. [Создайте группу во ВКонтакте](https://vk.com/groups_create).
2. Получите токен группы:
- Перейдите на страницу управления сообществом.
- В меню настроек выберите "Работа с API" и затем перейдите в раздел "Ключи доступа".
- Нажмите на кнопку "Создать ключ". Выберите нужные права доступа.
- Нажмите на кнопку "Создать". В результате вы получите токен доступа, который нужно использовать для работы с API группы.
3. Получите личный токен.
- Документация находится [по ссылке](https://dev.vk.com/api/access-token/implicit-flow-user).
4. Внесите личный токен, токен группы и номер группы в файл .env (см. `Установка зависимостей`)
5. Настройте базу данных (см. `Создание базы данных`)
6. В модуле [databases.py](/database/databases.py) запуститите функцию `create_tables`, котрая находится под конструкцией if __name__=="__main__".


### Установка компонентов

1. [Установите Python 3.x](https://www.python.org/downloads/) (рекомендуется версия Python 3.7 и выше)
2. [Установите PostgreSQL](https://www.postgresql.org/download/) и [PgAdmin](https://www.pgadmin.org/download/) для работы с базой данных.


### Установка зависимостей

1. Склонируйте репозиторий на свой компьютер.
2. В терминале IDE склонированного проекта установите зависимости с помощью команды:
`pip install -r requirements.txt`
3. В корневой директории проекта создайте файл с названием **.env** (по примеру .env_exs) и укажите в нем необходимые переменные окружения:
```
token_soob = ваш токен группы
token_vk = ваш личный токен
database = 'vkinder_db'
user = 'ваш логин в postgresql'
password = 'ваш пароль в postgresql'
group_id = 'ваш id группы'
```
4. Проверьте, что модуль config.py не сообщает об ошибках.


### Создание базы данных

1. Запустите PgAdmin и войдите в ваш сервер PostgreSQL.
2. Щелкните правой кнопкой мыши на "Базы данных" и выберите "Создать" -> "База данных...".
3. В открывшемся окне введите название базы данных "vkinder_db" в поле "Имя".
4. Нажмите "ОК" для создания базы данных.


### Запуск программы

- Запустите модуль main.py с помощью Run или команды в терминале: python main.py.
- Для остановки программы используйте сочетание клавиш Ctrl+C.


### Инструкция по работе с ботом

- Для начала работы необходимо отправить любое сообщение в группу, в которой развернут бот.
- В ответ придет сообщение с приветствием и кнопки "Начать работу" и "Завершить сеанс".
- При нажатии на "Начать работу" бот либо загрузит данные пользователя из базы данных либо, в случае нового пользователя, получит информацию о пользователи для настройки фильтров поиска по умольчанию. 
- Если открытые данные пользователя не позволяют настроить фильтры, бот запросит согласие на предоставление данных и, в случае подтверждения, последовательно предложит ввести недостающие данные.
- Далее бот предоставит информацию о настройках поиска для конкретного пользователя и клавиатуру основного меню, которая может быть различной в зависимости от некоторых факторов. Например, если у пользователя нет записей в "Избранном", кнопка "Просмотреть избранное" не появится.
- При нажатии на кнопку "Начать поиск" бот загрузит несколько открытых профилей, удовлетворяющих фильтрам и выведет информацию по первому профилю. Одновременно будет загружена клавиатура для навигации по результатам поиска. Для вывода данных по следующему профилю или возврата к предыдущему служат кнопки "Вперед" и "Назад". При просмотре всех профилей в рамках текущего сеанса - будет выведено соответствующее сообщение.
- Для получения новых результатов поиска нужно нажать "Начать поиск" в основном меню.
- Добавить в "избранное или в "черный список" также можно соответствующими кнопками.
- Вернуться в основное меню можно нажав на кнопку "В главное меню".
- Просмотреть изабранное можно нажав на кнопку "Просмотреть избранное" в основном меню.
- Изменить критерии поиска можно нажав на кнопку "Настроить фильтры" в основном меню. При этом бот начнет последовательно выводить клавиатуру с предложениями вариантов настроек прямо в чат. Последующие пункты меню будут появляться по мере выбора пользователем вариантов из предыдущих пунктов. При смене города, название города будет предложено ввести вручную. ВНИМАНИЕ: при изменении фильтров история поиска сбрасывается. "Избранное" и "Черный список" при этом сохраняются. 
- Для корректного окончания сеанса рекомендуется использовать кнопку "Завершить сеанс". Кнопка доступна на любом этапе работы с ботом, кроме этапа уточнения данных. После нажатия, клавиатура исчезнет и бот перейдет в режим ожидания. Для повторного начала работы достаточно ввести в чате с ботом любое сообщение.


### Структура каталога проекта

<details>
<summary>Развернуть</summary>

- main.py
- .env _exs
- .gitignore
- config.py
- requirements.txt
- Task_description
    - README.md
    - group_settings.md
    - Для командного проекта_2 чел.png
    - Для командного проекта_3 чел.png
- api
  - api_requests.py
- bot
  - bot_keyboards.py
  - bot_logic.py
  - bot_user_auth.py
- database
  - databases.py
  - models.py
</details>


### Описание модулей и файлов

<details>
<summary>Развернуть</summary>

#### Модуль [main.py](/main.py)
> Главный скрипт в приложении. Содержит основной код для запуска бота VKinder.

#### Файл .env _exs
> Пример для создание файла .env c конфигурационными данными, которые используются для настройки приложения.

#### Файл .gitignore
> Текстовый файл, используется для указания файлов и папок, которые не должны быть отслеживаемыми репозиторием.

#### Файл requirements.txt
>Текстовый файл, в котором перечислены все зависимости (пакеты и их версии), необходимые для корректной работы проекта.

#### Модуль [config.py](/config.py)
>Загружает переменные окружения из файла .env

### Папка Task_description
>В папке находятся файлы, содержащие описание задачи и требования к проекту.

### Пакет api 
- модуль [api_requests.py](/api/api_requests.py):


  > содержит класс VKSearch, который предоставляет методы для выполнения запросов к API ВКонтакте. Класс используется для получения информации о пользователях, формирования запросов для поиска партнеров, функции поиска, получения их фотографий и т.д.

### Пакет bot 

- модуль [bot_keyboards.py](/bot/bot_interface.py):


  > содержит функции для генерации, автоматического выбора, в соответствиис логикой программы и вывода пользователю клавиатур (кнопок) и сообщений.

- модуль [bot_logic.py](/bot/bot_logic.py):


  > содержит функции для обработки входящих данных, формирования данных в ответ на запрос, проверки ввода, вызова функций для взаимодействия с БД

- модуль [bot_user_auth.py](/bot/bot_user_auth.py):


  > содержит функцию, обеспечивающую сбор недостающих данных пользователя.

### Пакет database
- модуль [models.py](/database/models.py):


  > содержит функции для создания таблиц, функцию удаления таблиц.

- модуль [databases.py](/database/databases.py):


  > содержит функции для взаимодействия с таблицами в рамках логики бота.

</details>


### Авторы

- [Алена Четвернина](https://github.com/AlenChet)
- [Евгений Посохин](https://github.com/EvgeniyPosohin)
- [Максим Ермоленко](https://github.com/AACMKT)
